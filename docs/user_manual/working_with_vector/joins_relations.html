<!DOCTYPE html>
<html class="writer-html5" lang="ja" data-content_root="../../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>12.4. レイヤをまたいでデータを接続・編集する &mdash; QGIS Documentation  ドキュメント</title>
      <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../../../_static/css/qgis_docs.css?v=01847ad1" />
      <link rel="stylesheet" type="text/css" href="../../../_static/togglebutton.css?v=13237357" />
      <link rel="stylesheet" type="text/css" href="../../../_static/copybutton.css?v=76b2166b" />

  
    <link rel="shortcut icon" href="../../../_static/qgis_logo.ico"/>
    <link rel="canonical" href="https://docs.qgis.org/latest/en/docs/user_manual/working_with_vector/joins_relations.html"/>
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../../../_static/documentation_options.js?v=c033477b"></script>
        <script src="../../../_static/doctools.js?v=9a2dae69"></script>
        <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
        <script src="../../../_static/clipboard.min.js?v=a7894cd8"></script>
        <script src="../../../_static/copybutton.js?v=f281be69"></script>
        <script>let toggleHintShow = 'Click to show';</script>
        <script>let toggleHintHide = 'Click to hide';</script>
        <script>let toggleOpenOnPrint = 'true';</script>
        <script src="../../../_static/togglebutton.js?v=4a39c7ea"></script>
        <script src="../../../_static/translations.js?v=91613774"></script>
        <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
        <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="索引" href="../../../genindex.html" />
    <link rel="search" title="検索" href="../../../search.html" />
    <link rel="next" title="13. ラスタデータの操作" href="../working_with_raster/index.html" />
    <link rel="prev" title="12.3. 編集" href="editing_geometry_attributes.html" />
  <meta name="description" content="QGIS 3.40 documentation: 12.4. レイヤをまたいでデータを接続・編集する">
  <script>
    var _paq = window._paq = window._paq || [];
    _paq.push(["disableCookies"]);
    _paq.push(['trackPageView']);
    _paq.push(['enableLinkTracking']);
    (function() {
      var u="//matomo.qgis.org/";
      _paq.push(['setTrackerUrl', u+'matomo.php']);
      _paq.push(['setSiteId', '1']);
      var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
      g.async=true; g.src=u+'matomo.js'; s.parentNode.insertBefore(g,s);
    })();
  </script>
</head>

<body class="wy-body-for-nav">

  <nav class="release_status_topbar">
  </nav>

   

 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
   

          
          
          <a href="../../index.html" class="icon icon-home">
            QGIS Documentation
              <img src="../../../_static/logo.png" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                3.40
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
   <a href= "../../../genindex.html">索引</a>
 
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">About QGIS</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../about/preamble.html">はじめに</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../about/foreword.html">序文</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../about/conventions.html">表記規則</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../about/features.html">機能</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../about/help_and_support.html">ヘルプとサポート</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../about/contributors.html">協力者</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../about/license/index.html">Complying with Licenses</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">ユーザ向け</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">QGIS Desktop User Guide/Manual (QGIS 3.40)</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../introduction/getting_started.html">1. 最初のステップ</a></li>
<li class="toctree-l2"><a class="reference internal" href="../introduction/project_files.html">2. プロジェクトファイルの操作</a></li>
<li class="toctree-l2"><a class="reference internal" href="../introduction/qgis_gui.html">3. QGISのユーザインタフェース</a></li>
<li class="toctree-l2"><a class="reference internal" href="../introduction/browser.html">4. ブラウザパネル</a></li>
<li class="toctree-l2"><a class="reference internal" href="../introduction/qgis_configuration.html">5. QGISの設定</a></li>
<li class="toctree-l2"><a class="reference internal" href="../working_with_projections/working_with_projections.html">6. 投影法の操作</a></li>
<li class="toctree-l2"><a class="reference internal" href="../map_views/index.html">7. 地図の可視化</a></li>
<li class="toctree-l2"><a class="reference internal" href="../introduction/general_tools.html">8. 一般ツール</a></li>
<li class="toctree-l2"><a class="reference internal" href="../expressions/index.html">9. 式でレベルアップ</a></li>
<li class="toctree-l2"><a class="reference internal" href="../style_library/index.html">10. スタイルライブラリ</a></li>
<li class="toctree-l2"><a class="reference internal" href="../managing_data_source/index.html">11. データソースの管理</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">12. ベクタデータの操作</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="vector_properties.html">12.1. ベクタプロパティダイアログ</a></li>
<li class="toctree-l3"><a class="reference internal" href="attribute_table.html">12.2. 属性テーブルの操作</a></li>
<li class="toctree-l3"><a class="reference internal" href="editing_geometry_attributes.html">12.3. 編集</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">12.4. レイヤをまたいでデータを接続・編集する</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#joining-features-between-two-layers">12.4.1. 二つのレイヤの地物を結合する</a></li>
<li class="toctree-l4"><a class="reference internal" href="#setting-relations-between-multiple-layers">12.4.2. 複数のレイヤ間のリレーションを設定する</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../working_with_raster/index.html">13. ラスタデータの操作</a></li>
<li class="toctree-l2"><a class="reference internal" href="../working_with_mesh/mesh.html">14. メッシュデータの操作</a></li>
<li class="toctree-l2"><a class="reference internal" href="../working_with_vector_tiles/vector_tiles.html">15. ベクタタイルの操作</a></li>
<li class="toctree-l2"><a class="reference internal" href="../working_with_point_clouds/point_clouds.html">16. 点群の操作</a></li>
<li class="toctree-l2"><a class="reference internal" href="../working_with_3d_tiles/3d_tiles.html">17. 3Dタイルの操作</a></li>
<li class="toctree-l2"><a class="reference internal" href="../print_composer/index.html">18. 地図のレイアウト</a></li>
<li class="toctree-l2"><a class="reference internal" href="../working_with_ogc/ogc_client_support.html">19. OGC / ISOプロトコルの操作</a></li>
<li class="toctree-l2"><a class="reference internal" href="../working_with_gps/index.html">20. GPSデータの操作</a></li>
<li class="toctree-l2"><a class="reference internal" href="../auth_system/index.html">21. 認証システム</a></li>
<li class="toctree-l2"><a class="reference internal" href="../grass_integration/grass_integration.html">22. GRASS GIS の統合</a></li>
<li class="toctree-l2"><a class="reference internal" href="../processing/index.html">23. QGIS プロセシングフレームワーク</a></li>
<li class="toctree-l2"><a class="reference internal" href="../processing_algs/index.html">24. プロセシングプロバイダとアルゴリズム</a></li>
<li class="toctree-l2"><a class="reference internal" href="../plugins/index.html">25. プラグイン</a></li>
<li class="toctree-l2"><a class="reference internal" href="../appendices/index.html">26. 付録</a></li>
<li class="toctree-l2"><a class="reference internal" href="../literature_web/literature_and_web_references.html">27. 文献とWeb参照</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../server_manual/index.html">QGIS Server Guide/Manual (QGIS 3.40)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../training_manual/index.html">トレーニングマニュアル</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../gentle_gis_introduction/index.html">やさしい GIS 入門</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">ドキュメント執筆者向け</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../documentation_guidelines/index.html">ドキュメント作成のガイドライン</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">開発者向け</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../pyqgis_developer_cookbook/index.html">PyQGIS Cookbook (QGIS 3.40)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../developers_guide/index.html">開発者ガイド</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">QGIS Documentation</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">QGISユーザガイド</a></li>
          <li class="breadcrumb-item"><a href="index.html"><span class="section-number">12. </span>ベクタデータの操作</a></li>
      <li class="breadcrumb-item active"><span class="section-number">12.4. </span>レイヤをまたいでデータを接続・編集する</li>

    <li style="float: right; text-align: right;">
	<ul>
		
      <li class="wy-breadcrumbs-aside">
              <a href="https://github.com/qgis/QGIS-Documentation/blob/master/docs/user_manual/working_with_vector/joins_relations.rst" class="fa fa-github"> Edit on GitHub</a>
      </li>
	</ul>

        <!-- Add a button to guide potential contributors
	     To do: add a more generic page for contributing in QGIS docs to keep users in the same website
	     <a class="qgis-edit-guidelines" href="https://docs.qgis.org/3.40/ja/docs/documentation_guidelines/index.html">
	-->
	<a class="qgis-edit-guidelines" href="https://qgis.org/community/involve/">
		Learn how to contribute!
	</a>
    </li>


  </ul><div class="rst-breadcrumbs-buttons" role="navigation" aria-label="Sequential page navigation">
        <a href="editing_geometry_attributes.html" class="btn btn-neutral float-left" title="12.3. 編集" accesskey="p"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../working_with_raster/index.html" class="btn btn-neutral float-right" title="13. ラスタデータの操作" accesskey="n">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
  </div>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <blockquote>
<div><div class="admonition important">
<p class="admonition-title">重要</p>
<p>翻訳は <a class="reference internal" href="../../documentation_guidelines/do_translations.html#translation-guidelines"><span class="std std-ref">あなたが参加できる</span></a>  コミュニティの取り組みです。このページは現在 98.04% 翻訳されています。</p>
</div>
</div></blockquote>
<section id="connecting-and-editing-data-across-layers">
<span id="sec-joins-relations"></span><span id="index-0"></span><h1><span class="section-number">12.4. </span>レイヤをまたいでデータを接続・編集する<a class="headerlink" href="#connecting-and-editing-data-across-layers" title="Link to this heading"></a></h1>
<nav class="contents local" id="id1">
<ul class="simple">
<li><p><a class="reference internal" href="#joining-features-between-two-layers" id="id15">二つのレイヤの地物を結合する</a></p></li>
<li><p><a class="reference internal" href="#setting-relations-between-multiple-layers" id="id16">複数のレイヤ間のリレーションを設定する</a></p>
<ul>
<li><p><a class="reference internal" href="#one-to-many-1-n-relations" id="id17">1対多（1対N）のリレーション</a></p>
<ul>
<li><p><a class="reference internal" href="#layers-and-keys" id="id18">レイヤとキー</a></p></li>
<li><p><a class="reference internal" href="#defining-1-n-relations" id="id19">1対Nリレーションの定義</a></p></li>
<li><p><a class="reference internal" href="#forms-for-1-n-relations" id="id20">1対Nリレーションのフォーム</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#many-to-many-n-m-relations" id="id21">多対多（N対M）リレーション</a></p></li>
<li><p><a class="reference internal" href="#polymorphic-relations" id="id22">多態リレーション</a></p>
<ul>
<li><p><a class="reference internal" href="#the-purpose" id="id23">目的</a></p></li>
<li><p><a class="reference internal" href="#defining-polymorphic-relations" id="id24">多態リレーションの定義</a></p></li>
</ul>
</li>
</ul>
</li>
</ul>
</nav>
<p>異なるレイヤのデータを接続する能力は、GISソフトウェアの手腕の一つです。このような接続は、地物間の空間的関係、またはそれらが共有している属性に基づくことができます。QGISは、これらの関連付けを処理する次のようなツールを提供しています：</p>
<ul>
<li><p>プロセシングアルゴリズム、つまり <a class="reference internal" href="../processing_algs/qgis/vectorgeneral.html#qgisjoinattributesbylocation"><span class="std std-ref">属性の空間結合</span></a>, <a class="reference internal" href="../processing_algs/qgis/vectorgeneral.html#qgisjoinbynearest"><span class="std std-ref">属性の最近傍結合</span></a>, <a class="reference internal" href="../processing_algs/qgis/vectorgeneral.html#qgisjoinattributestable"><span class="std std-ref">属性テーブルで結合（table join）</span></a>, ...は、接続の結果として新しいレイヤを作成できます</p></li>
<li><p>SQLクエリを使って、 <a class="reference internal" href="../plugins/core_plugins/plugins_db_manager.html#dbmanager"><span class="std std-ref">DBマネージャ</span></a> または <a class="reference internal" href="../managing_data_source/create_layers.html#vector-virtual-layers"><span class="std std-ref">仮想レイヤ</span></a> から新しいレイヤを作成します</p></li>
<li><p><a class="reference internal" href="#sec-joins"><span class="std std-ref">プロパティを結合する</span></a> または <a class="reference internal" href="#vector-relations"><span class="std std-ref">リレーションの設定</span></a> は、属性のマッチングに基づいて、与えられたレイヤの地物の属性を、別のレイヤの属性を使って一時的に拡張します。</p>
<p>結合とリレーションはデータベースから借用した技術的な概念で、テーブルに格納されたデータを、その内容を結合することによって、最大限に活用するものです。つまり、異なるレイヤ（テーブル）の地物（行）同士を関連づけることができます。お互いに一致する行の数は任意です（0、1、多数）。</p>
</li>
</ul>
<section id="joining-features-between-two-layers">
<span id="sec-joins"></span><span id="index-1"></span><h2><a class="toc-backref" href="#id15" role="doc-backlink"><span class="section-number">12.4.1. </span>二つのレイヤの地物を結合する</a><a class="headerlink" href="#joining-features-between-two-layers" title="Link to this heading"></a></h2>
<p>QGISの <strong>結合</strong> では、現在のレイヤの地物を、読み込まれた別のベクタレイヤの地物に関連付けることができます。空間的に有効であるかどうかや、ジオメトリのタイプは関係ありません。結合は、レイヤが共有する属性に基づき、1対1の関係で行われます。</p>
<p>レイヤ（以下 <code class="docutils literal notranslate"><span class="pre">ターゲットレイヤ</span></code> と表記）上で結合を作成するには：</p>
<ol class="arabic simple">
<li><p>レイヤの <span class="menuselection">プロパティ ►</span> <a class="reference internal" href="../../../_images/join.png"><img alt="join" src="../../../_images/join.png" style="width: 2em;" /></a> <span class="guilabel">テーブル結合</span> タブに移動します</p></li>
<li><p><a class="reference internal" href="../../../_images/symbologyAdd.png"><img alt="symbologyAdd" src="../../../_images/symbologyAdd.png" style="width: 1.5em;" /></a> <sup>新規結合を追加</sup> ボタンをクリックします。 <span class="guilabel">ベクタ結合を追加</span> ダイアログが現れます。</p></li>
<li><p>ターゲットベクタレイヤと結合させたい <span class="guilabel">結合するレイヤ</span> を選択します。</p></li>
<li><p>（<code class="docutils literal notranslate"><span class="pre">結合するレイヤ</span></code> の）:guilabel:<cite>結合基準の属性</cite> と （<code class="docutils literal notranslate"><span class="pre">ターゲットレイヤ</span></code> の）:guilabel:<cite>ターゲット属性</cite> を指定します。これらは両方のレイヤで一致する地物を見つけるために使用されるフィールドなので、共通の値を持つ必要があります。</p></li>
<li><p><span class="guilabel">OK</span> ボタンを押すと、選択したパラメータの概要が <span class="guilabel">テーブル結合</span> パネルに表示されます。</p></li>
</ol>
<figure class="align-center" id="id2">
<span id="figure-joins"></span><img alt="../../../_images/join_attributes.png" src="../../../_images/join_attributes.png" />
<figcaption>
<p><span class="caption-number">図 12.105 </span><span class="caption-text">既存のベクタレイヤに属性テーブルを結合する</span><a class="headerlink" href="#id2" title="Link to this image"></a></p>
</figcaption>
</figure>
<p>上記のステップでは、結合レイヤで <strong>最初に一致した地物</strong> の <strong>全ての</strong> 属性がターゲットレイヤの地物に追加される結合が作成されます。結合処理では以下のロジックを使って地物を組にします:</p>
<ul class="simple">
<li><p>一致するかどうかに関係なくターゲットレイヤの全ての地物が返されます</p></li>
<li><p>ターゲット属性に重複する値が含まれる場合、それらの地物には結合するレイヤの同じ地物が割り当てられます。</p></li>
<li><p>結合基準の属性に、重複して一致する値が含まれている場合、最初に取得された地物のみが選択されます。</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">注釈</p>
<p>QGISでの結合はひとつのフィールドの一致に基づいているため、たいていの場合、一致可能なフィールドの値が一意であることを確認したいでしょう。</p>
</div>
<p>QGISでは、結合を微調整するためのオプションがいくつか用意されています:</p>
<ul class="simple">
<li><p><a class="reference internal" href="../../../_images/checkbox.png"><img alt="checkbox" src="../../../_images/checkbox.png" style="width: 1.3em;" /></a> <span class="guilabel">結合レイヤをキャッシュ</span> ：探索を高速化するために、結合レイヤの値を（ジオメトリなしで）メモリにキャッシュできるようになります。</p></li>
<li><p><a class="reference internal" href="../../../_images/unchecked.png"><img alt="unchecked" src="../../../_images/unchecked.png" style="width: 1.3em;" /></a> <span class="guilabel">結合属性にインデックスを作成</span> して探索を高速化</p></li>
<li><p><a class="reference internal" href="../../../_images/unchecked.png"><img alt="unchecked" src="../../../_images/unchecked.png" style="width: 1.3em;" /></a> <span class="guilabel">動的フォーム（結合レイヤと連動）</span> ： <span class="guilabel">ターゲット属性</span> の変更に応じて結合属性をオンザフライで同期できるようになります。これにより、結合属性の制約条件も適切に更新されます。たくさんの地物や無数の結合がある場合には非常に時間がかかることがあるため、この機能はデフォルトでは無効化されていることに注意してください。</p></li>
<li><p>ターゲットレイヤが編集可能な場合には、フィールドの横の属性テーブルにはステータスを知らせるためのアイコンが表示されます：</p>
<ul>
<li><p><a class="reference internal" href="../../../_images/mIconJoinNotEditable.png"><img alt="joinNotEditable" src="../../../_images/mIconJoinNotEditable.png" style="width: 1.5em;" /></a> ：結合レイヤが編集可能に設定されていません。ターゲットの属性テーブルから結合地物を編集できるようにしたい場合は、 <a class="reference internal" href="../../../_images/checkbox.png"><img alt="checkbox" src="../../../_images/checkbox.png" style="width: 1.3em;" /></a> <span class="guilabel">編集可能な結合レイヤ</span> オプションにチェックを入れる必要があります。</p></li>
<li><p><a class="reference internal" href="../../../_images/mIconJoinedLayerNotEditable.png"><img alt="joinedLayerNotEditable" src="../../../_images/mIconJoinedLayerNotEditable.png" style="width: 1.5em;" /></a> ：結合レイヤは編集可能に設定されていますが、現在のステータスは読み取り専用です。</p></li>
<li><p><a class="reference internal" href="../../../_images/mIconJoinHasNotUpsertOnEdit.png"><img alt="joinHasNotUpsertOnEdit" src="../../../_images/mIconJoinHasNotUpsertOnEdit.png" style="width: 1.5em;" /></a> ：結合レイヤは編集可能ですが、同期メカニズムは有効ではありません。ターゲットレイヤに地物が作成されたときに、結合レイヤに地物を自動的に追加したい場合には、 <a class="reference internal" href="../../../_images/checkbox.png"><img alt="checkbox" src="../../../_images/checkbox.png" style="width: 1.3em;" /></a> <span class="guilabel">編集時Upsert</span> オプションにチェックを入れる必要があります。対称的に、結合した地物を自動的に削除したい場合には、 <a class="reference internal" href="../../../_images/checkbox.png"><img alt="checkbox" src="../../../_images/checkbox.png" style="width: 1.3em;" /></a> <span class="guilabel">カスケード削除</span> を有効にする必要があります。</p></li>
</ul>
</li>
<li><p><a class="reference internal" href="../../../_images/unchecked.png"><img alt="unchecked" src="../../../_images/unchecked.png" style="width: 1.3em;" /></a> <span class="guilabel">結合属性</span> ：結合するレイヤの全てのフィールドを追加するのではなく、その一部分を指定することができます。</p></li>
<li><p><a class="reference internal" href="../../../_images/unchecked.png"><img alt="unchecked" src="../../../_images/unchecked.png" style="width: 1.3em;" /></a> <span class="guilabel">カスタムフィールド名の接頭辞</span> ：名前の衝突を回避するために付けられる結合属性の接頭辞</p></li>
</ul>
</section>
<section id="setting-relations-between-multiple-layers">
<span id="vector-relations"></span><span id="index-2"></span><h2><a class="toc-backref" href="#id16" role="doc-backlink"><span class="section-number">12.4.2. </span>複数のレイヤ間のリレーションを設定する</a><a class="headerlink" href="#setting-relations-between-multiple-layers" title="Link to this heading"></a></h2>
<p>2つのレイヤにわたる地物間の1対1のリンクを定義する結合とは異なり、リレーションは2つ以上のレイヤにわたる複数の地物間の相互接続を構築するのに役立ちます。リレーションはプロジェクトレベルの設定であり、<span class="menuselection">プロジェクト ► プロパティ ►</span> <a class="reference internal" href="../../../_images/relations.png"><img alt="関係" src="../../../_images/relations.png" style="width: 1.5em;" /></a> <span class="guilabel">リレーション</span> タブで設定します。そこから、次の操作が可能です:</p>
<ul>
<li><p><a class="reference internal" href="../../../_images/symbologyAdd.png"><img alt="symbologyAdd" src="../../../_images/symbologyAdd.png" style="width: 1.5em;" /></a> <span class="guilabel">リレーションを追加</span> タイプは次のいずれかです:</p>
<ul class="simple">
<li><p><a class="reference internal" href="#one-to-many-relation"><span class="std std-ref">一対多のリレーション</span></a></p></li>
<li><p><a class="reference internal" href="#many-to-many-relation"><span class="std std-ref">多対多のリレーション</span></a></p></li>
<li><p><a class="reference internal" href="#polymorphic-relation"><span class="std std-ref">多態リレーション</span></a> は、アクションのドロップダウンメニューにある専用ツールで追加または編集できます。</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">注釈</p>
<p>一度作成された非多態リレーションを編集する簡単な方法はまだありません。名前のみダブルクリックで編集できます。そのようなリレーションの他のパラメータを編集するには、一度削除して再作成する必要があります。</p>
</div>
</li>
<li><p><a class="reference internal" href="../../../_images/symbologyAdd.png"><img alt="symbologyAdd" src="../../../_images/symbologyAdd.png" style="width: 1.5em;" /></a> <span class="guilabel">リレーションを検索</span>: QGISはサポートされているデータベース形式（PostgreSQL、GeoPackage、ESRI File Geodatabaseなど）から既存のリレーションを検出することができます。これはリレーションの定義を容易にする良い方法です。</p></li>
<li><p><a class="reference internal" href="../../../_images/symbologyRemove.png"><img alt="symbologyRemove" src="../../../_images/symbologyRemove.png" style="width: 1.5em;" /></a> <span class="guilabel">リレーションを削除</span></p></li>
</ul>
<figure class="align-center" id="id3">
<span id="figure-relations"></span><img alt="../../../_images/project_relations.png" src="../../../_images/project_relations.png" />
<figcaption>
<p><span class="caption-number">図 12.106 </span><span class="caption-text">リレーションタブ</span><a class="headerlink" href="#id3" title="Link to this image"></a></p>
</figcaption>
</figure>
<section id="one-to-many-1-n-relations">
<span id="one-to-many-relation"></span><h3><a class="toc-backref" href="#id17" role="doc-backlink"><span class="section-number">12.4.2.1. </span>1対多（1対N）のリレーション</a><a class="headerlink" href="#one-to-many-1-n-relations" title="Link to this heading"></a></h3>
<p>例として、アラスカのすべての地域（ポリゴン）を有するレイヤがあり、名前、地域タイプ、（主キーとして機能する）ユニークIDといった属性を持っているとします。</p>
<p>それから、地域にある空港の情報を持った別のポイントレイヤまたはテーブルがあり、これらの情報も把握したいとします。ほとんどの地域には複数の空港があるため、これらを地域レイヤに追加する場合は、外部キーを使って1対多のリレーションを作成する必要があります。</p>
<figure class="align-center" id="id4">
<span id="figure-relations-map"></span><img alt="../../../_images/regions_with_airports.png" src="../../../_images/regions_with_airports.png" />
<figcaption>
<p><span class="caption-number">図 12.107 </span><span class="caption-text">空港とアラスカの地域</span><a class="headerlink" href="#id4" title="Link to this image"></a></p>
</figcaption>
</figure>
<section id="layers-and-keys">
<h4><a class="toc-backref" href="#id18" role="doc-backlink">レイヤとキー</a><a class="headerlink" href="#layers-and-keys" title="Link to this heading"></a></h4>
<p>QGISでは、テーブルとベクタレイヤの間に違いはありません。基本的には、ベクタレイヤとはジオメトリを持っているテーブルのことです。このため、テーブルはベクタレイヤとして追加することができます。 1対Nリレーションの例示として、 サンプルデータセットの <code class="file docutils literal notranslate"><span class="pre">regions</span></code> と <code class="file docutils literal notranslate"><span class="pre">airports</span></code> レイヤを読み込んでみましょう。実際、各空港は正確に1つの地域に属しますが、各地域は任意の数の空港を持つことができます（典型的な1対多リレーション）。</p>
<p>レイヤ地域への外部キー・フィールド（<code class="docutils literal notranslate"><span class="pre">fk_region</span></code>）を持ちます。</p>
<p>空港を説明する属性に加え、空港レイヤには外部キーとして機能するもうひとつのフィールド <code class="docutils literal notranslate"><span class="pre">fk_region</span></code> があります（データベースを持っている場合は、おそらくこのフィールドに制約を定義したいと思うでしょう）。この <code class="docutils literal notranslate"><span class="pre">fk_region</span></code> フィールドには、常に地域のIDが含まれます。これは、その属する地域へのポインタのように見ることができます。</p>
<p>QGISにレイヤ間のリレーションを伝えるだけで、編集用のカスタム編集フォームを設計でき、QGISが設定を管理します。それはさまざまなプロバイダで動作します（ですからシェープファイルやCSVファイルでも使用できます）。</p>
</section>
<section id="defining-1-n-relations">
<h4><a class="toc-backref" href="#id19" role="doc-backlink">1対Nリレーションの定義</a><a class="headerlink" href="#defining-1-n-relations" title="Link to this heading"></a></h4>
<p>まず最初に行うのは、レイヤ間の関係をQGISに知らせることです。これは、 <span class="menuselection">プロジェクト ► プロパティ...</span> で行います。 <span class="guilabel">リレーション</span> タブを開き、 <a class="reference internal" href="../../../_images/symbologyAdd.png"><img alt="symbologyAdd" src="../../../_images/symbologyAdd.png" style="width: 1.5em;" /></a> <span class="guilabel">リレーションを追加</span> をクリックします。</p>
<ul>
<li><p><strong>名前</strong> はタイトルとして使用されます。これはリレーションが何のために用いられるのかを説明する、人が読める文字列であるべきです。ここでは、単に <strong>airport_relation</strong> と名前を付けましょう。</p></li>
<li><p><strong>参照先レイヤ（親）</strong> 親レイヤとも呼ばれ、主キーを持っており、参照されるレイヤです。この例では、 <code class="docutils literal notranslate"><span class="pre">regions</span></code> レイヤです。参照先レイヤの主キーを定義する必要があり、ここでは <code class="docutils literal notranslate"><span class="pre">ID</span></code> を指定します。</p></li>
<li><p><strong>参照元レイヤ（子）</strong> 子レイヤとも呼ばれ、外部キーフィールドを持ったレイヤです。この例では、 <code class="docutils literal notranslate"><span class="pre">airports</span></code> レイヤが該当します。参照元レイヤには他のレイヤを指す参照フィールドを指定する必要があり、ここでは <code class="docutils literal notranslate"><span class="pre">fk_region</span></code> とします。</p>
<div class="admonition note">
<p class="admonition-title">注釈</p>
<p>場合によっては、レイヤ内の地物を一意に識別するためには複数のフィールドが必要となることがあります。このようなレイヤとのリレーションを作成するためには、 <strong>複合キー</strong> 、すなわち、一致するフィールドの複数ペアが必要です。 <a class="reference internal" href="../../../_images/symbologyAdd.png"><img alt="symbologyAdd" src="../../../_images/symbologyAdd.png" style="width: 1.5em;" /></a> <sup>複合外部キーとしてペアのフィールドを追加</sup> ボタンを使用して、必要な数のペアを追加できます。</p>
</div>
</li>
<li><p><strong>Id</strong> は内部的な目的で使用され、ユニークでなければなりません。これは <a class="reference internal" href="vector_properties.html#customize-form"><span class="std std-ref">カスタムフォーム</span></a> を作成するために必要となる場合があります。空のままにしておくと自動でIdを作成しますが、扱いやすいように自分でIdを指定することもできます。</p></li>
<li><p><strong>リレーションの強度</strong> は、親子レイヤ間のリレーションの強さを設定します。デフォルトの <span class="guilabel">Association</span> タイプは、親レイヤが子レイヤに <em>単に</em> リンクされていることを意味します。 一方、 <span class="guilabel">コンポジション</span> タイプでは、親レイヤを複製するときに子レイヤも複製され、親レイヤの地物を削除すると子レイヤの地物も削除されます。これはすべてのレベルにカスケードしていきます（つまり、子レイヤのそのまた子レイヤ...も一緒に削除されます）。</p></li>
</ul>
<figure class="align-center" id="id5">
<span id="figure-relations-manager"></span><img alt="../../../_images/regions_airports_mapping.png" src="../../../_images/regions_airports_mapping.png" />
<figcaption>
<p><span class="caption-number">図 12.108 </span><span class="caption-text">regionsレイヤとairportsレイヤ間のリレーションの追加</span><a class="headerlink" href="#id5" title="Link to this image"></a></p>
</figcaption>
</figure>
<p><span class="guilabel">リレーション</span> タブでは、 <a class="reference internal" href="../../../_images/symbologyAdd.png"><img alt="symbologyAdd" src="../../../_images/symbologyAdd.png" style="width: 1.5em;" /></a> <span class="guilabel">リレーションを検索</span> ボタンを押して、読み込んだレイヤの利用可能なリレーションをプロバイダから取得することもできます。この機能はPostgreSQLやSpatiaLiteといったデータプロバイダに保存されたレイヤで使用可能です。</p>
</section>
<section id="forms-for-1-n-relations">
<span id="index-3"></span><h4><a class="toc-backref" href="#id20" role="doc-backlink">1対Nリレーションのフォーム</a><a class="headerlink" href="#forms-for-1-n-relations" title="Link to this heading"></a></h4>
<p>これで、QGISはリレーションを把握できました。これはQGISが生成するフォームを改善するために利用されます。デフォルトのフォームのメソッド（自動生成）を変更していないので、改善はフォームに新しいウィジェットが追加されるのみです。それでは、凡例のregionsレイヤを選択して、識別ツールを使ってみましょう。設定によってはフォームが直接開くこともありますが、識別ダイアログのアクションから選択して地物フォームを開く必要があるかもしれません。</p>
<figure class="align-center" id="id6">
<span id="figure-embedded-form"></span><img alt="../../../_images/airport_relation_dataview.png" src="../../../_images/airport_relation_dataview.png" />
<figcaption>
<p><span class="caption-number">図 12.109 </span><span class="caption-text">airportsへのリレーションを持つregionsの識別ダイアログ</span><a class="headerlink" href="#id6" title="Link to this image"></a></p>
</figcaption>
</figure>
<p>見ればわかるとおり、この特定の地域に割り当てられた空港が全てテーブル表示されています。また、いくつかのボタンも用意されています。早速見てみましょう。</p>
<ul class="simple">
<li><p><a class="reference internal" href="../../../_images/mActionToggleEditing.png"><img alt="toggleEditing" src="../../../_images/mActionToggleEditing.png" style="width: 1.5em;" /></a> ボタンは編集モードを切り替えるためのものです。regionsレイヤの地物の地物フォームを開いていますが、このボタンはairportsレイヤの編集モードを切り替えることに注意してください。ただしこのテーブルは、airportsレイヤの地物を表しています。</p></li>
<li><p><a class="reference internal" href="../../../_images/mActionSaveEdits.png"><img alt="saveEdits" src="../../../_images/mActionSaveEdits.png" style="width: 1.5em;" /></a> ボタンは、子レイヤ（airports）の編集の全てを保存します。</p></li>
<li><p><a class="reference internal" href="../../../_images/mActionCapturePoint.png"><img alt="capturePoint" src="../../../_images/mActionCapturePoint.png" style="width: 1.5em;" /></a> ボタンを使用するとマップキャンバス上でairportsレイヤのジオメトリのデジタイズを行うことができ、デフォルトで現在のregionに新しい地物を割り当てます。アイコンはジオメトリタイプによって変わることに注意してください。</p></li>
<li><p><a class="reference internal" href="../../../_images/mActionNewTableRow.png"><img alt="newTableRow" src="../../../_images/mActionNewTableRow.png" style="width: 1.5em;" /></a> ボタンは、airportsレイヤの属性テーブルに新しいレコードを追加します。この新しい地物はデフォルトで現在のregionに割り当てられます。ジオメトリは、 <span class="guilabel">部分を追加</span> デジタイジングツールを使用して後から追加できます。</p></li>
<li><p><a class="reference internal" href="../../../_images/mActionDuplicateFeature.png"><img alt="duplicateFeature" src="../../../_images/mActionDuplicateFeature.png" style="width: 1.5em;" /></a> ボタンは、子レイヤ内の一つまたは複数の子地物を複製することができます。複製した子地物は後から別の親地物に割り当てることもできますし、属性値を編集することもできます。</p></li>
<li><p><a class="reference internal" href="../../../_images/mActionDeleteSelectedFeatures.png"><img alt="deleteSelectedFeatures" src="../../../_images/mActionDeleteSelectedFeatures.png" style="width: 1.5em;" /></a> ボタンは、選択した空港（複数可）を永久的に削除します。</p></li>
<li><p><a class="reference internal" href="../../../_images/mActionLink.png"><img alt="link" src="../../../_images/mActionLink.png" style="width: 1.5em;" /></a> シンボルをクリックすると、新しいダイアログが開き、既存の空港を選択して現在の地域に割り当てることができます。これは、誤って違う地域の上に空港を作成してしまった場合に便利です。</p></li>
<li><p><a class="reference internal" href="../../../_images/mActionUnlink.png"><img alt="unlink" src="../../../_images/mActionUnlink.png" style="width: 1.5em;" /></a> シンボルは、選択した空港（複数可）を現在の地域からリンク解除し、効果的に未割り当て状態（外部キーをNULLに設定）にします。</p></li>
<li><p><a class="reference internal" href="../../../_images/mActionZoomToSelected.png"><img alt="zoomToSelected" src="../../../_images/mActionZoomToSelected.png" style="width: 1.5em;" /></a> ボタンを押すと、選択した子地物にマップをズームさせます。</p></li>
<li><p>右にある <a class="reference internal" href="../../../_images/mActionFormView.png"><img alt="formView" src="../../../_images/mActionFormView.png" style="width: 1.2em;" /></a> と <a class="reference internal" href="../../../_images/mActionOpenTable.png"><img alt="openTable" src="../../../_images/mActionOpenTable.png" style="width: 1.5em;" /></a> の2つのボタンは、リレーションのある子地物の <a class="reference internal" href="attribute_table.html#attribute-table-view"><span class="std std-ref">テーブル表示とフォーム表示</span></a> を切り替えます。</p></li>
</ul>
<p>regionsレイヤの地物に <a class="reference internal" href="vector_properties.html#customize-form"><span class="std std-ref">ドラッグ＆ドロップデザイナー</span></a> を使用している場合には、どのツールを利用可能か選択できます。新しい地物が追加されたときに新しいフォームを開くかどうかは、 <span class="guilabel">地物追加時のフォームを表示しない</span> オプションで決めることができます。このオプションが正しく動作するためには、NULLでない属性は有効なデフォルト値をとる必要があることに注意してください。</p>
<figure class="align-center" id="id7">
<span id="figure-select-relation-tools"></span><img alt="../../../_images/airport_relation_formproperties.png" src="../../../_images/airport_relation_formproperties.png" />
<figcaption>
<p><span class="caption-number">図 12.110 </span><span class="caption-text">regionsレイヤとairportsレイヤのリレーションツールを設定するドラッグ＆ドロップデザイナー</span><a class="headerlink" href="#id7" title="Link to this image"></a></p>
</figcaption>
</figure>
<p>上記の例では、参照元レイヤがジオメトリを持っている（つまり、単なる英数字のテーブルではない）ので、上記の手順では、対応するジオメトリ地物を持たないエントリがレイヤの属性テーブルに作成されます。ジオメトリを追加するには、以下の操作を行います。</p>
<ol class="arabic simple">
<li><p>参照元レイヤの <a class="reference internal" href="../../../_images/mActionOpenTable.png"><img alt="openTable" src="../../../_images/mActionOpenTable.png" style="width: 1.5em;" /></a> <span class="menuselection">属性テーブルを開く</span> を選択します。</p></li>
<li><p>被参照レイヤの地物フォーム内で追加したレコードを選択します。</p></li>
<li><p><a class="reference internal" href="../../../_images/mActionAddPart.png"><img alt="addPart" src="../../../_images/mActionAddPart.png" style="width: 1.5em;" /></a> <sup>部分を追加</sup> デジタイジングツールを使用して、選択した属性テーブルのレコードとジオメトリを結びつけます。</p></li>
</ol>
<p>airportsテーブルで作業しているのなら、 <code class="docutils literal notranslate"><span class="pre">fk_region</span></code> フィールド（リレーションを作成するために使用するフィールド）には、「リレーションの参照」ウィジェットが自動的に設定されます。詳細は <a class="reference internal" href="vector_properties.html#configure-field"><span class="std std-ref">リレーションの参照ウィジェット</span></a> を参照してください。</p>
<p>airportsレイヤのフォームには、 <code class="docutils literal notranslate"><span class="pre">fk_region</span></code> フィールドの右側に <a class="reference internal" href="../../../_images/mActionFormView.png"><img alt="formView" src="../../../_images/mActionFormView.png" style="width: 1.2em;" /></a> ボタンがあることがわかります。このボタンをクリックすると、regionsレイヤのフォームが開きます。このウィジェットで、簡単に素早くリンクしている親地物のフォームを開くことができます。</p>
<figure class="align-center" id="id8">
<span id="figure-linked-forms"></span><img alt="../../../_images/airport_attributes.png" src="../../../_images/airport_attributes.png" />
<figcaption>
<p><span class="caption-number">図 12.111 </span><span class="caption-text">regionsへのリレーションを持つairportsの識別ダイアログ</span><a class="headerlink" href="#id8" title="Link to this image"></a></p>
</figcaption>
</figure>
<p>「リレーションの参照」ウィジェットには、親レイヤのフォームを子レイヤに埋め込むオプションもあります。これは、airportsレイヤの <span class="menuselection">プロパティ ► 属性フォーム</span> メニューから設定できます。 <code class="docutils literal notranslate"><span class="pre">fk_region</span></code> フィールドを選択して、 <code class="docutils literal notranslate"><span class="pre">埋め込みフォームの表示</span></code> オプションにチェックを入れてください。</p>
<p>今、地物ダイアログを見ると、regionsのフォームがairportsのフォームの中に組み込まれていて、現在の空港を別の地域に割り当てることができるコンボボックスもあることが分かります。</p>
<figure class="align-center" id="figure-linked-forms-embedded">
<img alt="../../../_images/airport_attributes_expanded.png" src="../../../_images/airport_attributes_expanded.png" />
</figure>
<p>さらに、airportsレイヤの編集モードを切り替えると、 <code class="docutils literal notranslate"><span class="pre">fk_region</span></code> フィールドにオートコンプリート機能も追加されます。入力中に regionsレイヤの <code class="docutils literal notranslate"><span class="pre">id</span></code> フィールドの値がすべて表示されることがわかります。ここで、airportsレイヤの <span class="menuselection">プロパティ ► 属性フォーム</span> メニューの <code class="docutils literal notranslate"><span class="pre">新しい地物の追加</span></code> オプションを選択した場合、 <a class="reference internal" href="../../../_images/symbologyAdd.png"><img alt="symbologyAdd" src="../../../_images/symbologyAdd.png" style="width: 1.5em;" /></a> ボタンを使用してregionsレイヤのポリゴンをデジタイズすることができます。</p>
<p>子レイヤは、 <a class="reference internal" href="../introduction/general_tools.html#select-by-value"><span class="std std-ref">値による地物選択</span></a> ツールで子レイヤの属性に基づいて親レイヤの地物を選択するために使うこともできます。</p>
<p><a class="reference internal" href="#figure-select-by-value"><span class="std std-numref">図 12.112</span></a> では、空港の平均高度が海抜500mより高い地域すべてを選択しています。</p>
<p>フォームには多数のさまざまな集計関数があることがわかります。</p>
<figure class="align-center" id="id9">
<span id="figure-select-by-value"></span><img alt="../../../_images/relation_select_by_value.png" src="../../../_images/relation_select_by_value.png" />
<figcaption>
<p><span class="caption-number">図 12.112 </span><span class="caption-text">子レイヤの値で親レイヤの地物を選択する</span><a class="headerlink" href="#id9" title="Link to this image"></a></p>
</figcaption>
</figure>
</section>
</section>
<section id="many-to-many-n-m-relations">
<span id="many-to-many-relation"></span><span id="index-4"></span><h3><a class="toc-backref" href="#id21" role="doc-backlink"><span class="section-number">12.4.2.2. </span>多対多（N対M）リレーション</a><a class="headerlink" href="#many-to-many-n-m-relations" title="Link to this heading"></a></h3>
<p>N対Mのリレーションとは、2つのテーブル間の多数対多数の関係のことです。例えば、 <code class="docutils literal notranslate"><span class="pre">airports</span></code> レイヤと <code class="docutils literal notranslate"><span class="pre">airlines</span></code> レイヤを考えてみましょう。空港には複数の航空会社が乗り入れており、航空会社は複数の空港に乗り入れています。</p>
<p>以下のSQLコードは、 <em>locations</em> という名前のPostgreSQL/PostGISスキーマに、N対Mリレーションに必要な3つのテーブルを作成します。このコードは、PostGISの <span class="menuselection">データベース ► DBマネージャ…</span> や <a class="reference external" href="https://www.pgadmin.org">pgAdmin</a> のような外部ツールを使って実行できます。airportsテーブルには <code class="docutils literal notranslate"><span class="pre">airports</span></code> レイヤが、airlinesテーブルには <code class="docutils literal notranslate"><span class="pre">airlines</span></code> レイヤが格納されます。どちらのテーブルにも、分かりやすくするためにいくつかのフィールドが使われています。 <em>トリッキー</em> な部分は <code class="docutils literal notranslate"><span class="pre">airports_airlines</span></code> テーブルです。このテーブルは、すべての空港に対するすべての航空会社（またはその逆）をリストアップするために必要です。この種のテーブルは <em>ピボットテーブル</em> として知られています。このテーブルの <em>制約</em> は、両方とも互いのレイヤにある場合にのみ、空港と航空会社を関連づけられるものとすることを強制します。</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">CREATE</span><span class="w"> </span><span class="k">SCHEMA</span><span class="w"> </span><span class="n">locations</span><span class="p">;</span>

<span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">locations</span><span class="p">.</span><span class="n">airports</span>
<span class="p">(</span>
<span class="w">   </span><span class="n">id</span><span class="w"> </span><span class="nb">serial</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">   </span><span class="n">geom</span><span class="w"> </span><span class="n">geometry</span><span class="p">(</span><span class="n">Point</span><span class="p">,</span><span class="w"> </span><span class="mi">4326</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">   </span><span class="n">airport_name</span><span class="w"> </span><span class="nb">text</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">   </span><span class="k">CONSTRAINT</span><span class="w"> </span><span class="n">airports_pkey</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="p">(</span><span class="n">id</span><span class="p">)</span>
<span class="p">);</span>

<span class="k">CREATE</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="n">airports_geom_idx</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">locations</span><span class="p">.</span><span class="n">airports</span><span class="w"> </span><span class="k">USING</span><span class="w"> </span><span class="n">gist</span><span class="w"> </span><span class="p">(</span><span class="n">geom</span><span class="p">);</span>

<span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">locations</span><span class="p">.</span><span class="n">airlines</span>
<span class="p">(</span>
<span class="w">   </span><span class="n">id</span><span class="w"> </span><span class="nb">serial</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">   </span><span class="n">geom</span><span class="w"> </span><span class="n">geometry</span><span class="p">(</span><span class="n">Point</span><span class="p">,</span><span class="w"> </span><span class="mi">4326</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">   </span><span class="n">airline_name</span><span class="w"> </span><span class="nb">text</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">   </span><span class="k">CONSTRAINT</span><span class="w"> </span><span class="n">airlines_pkey</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="p">(</span><span class="n">id</span><span class="p">)</span>
<span class="p">);</span>

<span class="k">CREATE</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="n">airlines_geom_idx</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">locations</span><span class="p">.</span><span class="n">airlines</span><span class="w"> </span><span class="k">USING</span><span class="w"> </span><span class="n">gist</span><span class="w"> </span><span class="p">(</span><span class="n">geom</span><span class="p">);</span>

<span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">locations</span><span class="p">.</span><span class="n">airports_airlines</span>
<span class="p">(</span>
<span class="w">   </span><span class="n">id</span><span class="w"> </span><span class="nb">serial</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">   </span><span class="n">airport_fk</span><span class="w"> </span><span class="nb">integer</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">   </span><span class="n">airline_fk</span><span class="w"> </span><span class="nb">integer</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">   </span><span class="k">CONSTRAINT</span><span class="w"> </span><span class="n">airports_airlines_pkey</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="p">(</span><span class="n">id</span><span class="p">),</span>
<span class="w">   </span><span class="k">CONSTRAINT</span><span class="w"> </span><span class="n">airports_airlines_airport_fk_fkey</span><span class="w"> </span><span class="k">FOREIGN</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="p">(</span><span class="n">airport_fk</span><span class="p">)</span>
<span class="w">      </span><span class="k">REFERENCES</span><span class="w"> </span><span class="n">locations</span><span class="p">.</span><span class="n">airports</span><span class="w"> </span><span class="p">(</span><span class="n">id</span><span class="p">)</span>
<span class="w">      </span><span class="k">ON</span><span class="w"> </span><span class="k">DELETE</span><span class="w"> </span><span class="k">CASCADE</span>
<span class="w">      </span><span class="k">ON</span><span class="w"> </span><span class="k">UPDATE</span><span class="w"> </span><span class="k">CASCADE</span>
<span class="w">      </span><span class="k">DEFERRABLE</span><span class="w"> </span><span class="k">INITIALLY</span><span class="w"> </span><span class="k">DEFERRED</span><span class="p">,</span>
<span class="w">   </span><span class="k">CONSTRAINT</span><span class="w"> </span><span class="n">airports_airlines_airline_fk_fkey</span><span class="w"> </span><span class="k">FOREIGN</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="p">(</span><span class="n">airline_fk</span><span class="p">)</span>
<span class="w">      </span><span class="k">REFERENCES</span><span class="w"> </span><span class="n">locations</span><span class="p">.</span><span class="n">airlines</span><span class="w"> </span><span class="p">(</span><span class="n">id</span><span class="p">)</span>
<span class="w">      </span><span class="k">ON</span><span class="w"> </span><span class="k">DELETE</span><span class="w"> </span><span class="k">CASCADE</span>
<span class="w">      </span><span class="k">ON</span><span class="w"> </span><span class="k">UPDATE</span><span class="w"> </span><span class="k">CASCADE</span>
<span class="w">      </span><span class="k">DEFERRABLE</span><span class="w"> </span><span class="k">INITIALLY</span><span class="w"> </span><span class="k">DEFERRED</span>
<span class="w"> </span><span class="p">);</span>
</pre></div>
</div>
<p>PostgreSQLの代わりに、GeoPackageを使うこともできます。この場合には、3つのテーブルは <span class="menuselection">データベース ► DBマネージャ…</span> を使用して手動で作成します。GeoPackageにはスキーマが無いため、 <em>locations</em> の接頭辞は不要です。</p>
<p><code class="docutils literal notranslate"><span class="pre">airports_airlines</span></code> テーブルの外部キー制約は、 <span class="menuselection">テーブル ► テーブルを作成…</span> や <span class="menuselection">テーブル ► テーブルの編集…</span> では作成することができません。このため、このテーブルは <span class="menuselection">データベース ► SQLウィンドウ…</span> を使用して作成する必要があります。GeoPackageは <em>ADD CONSTRAINT</em> 文をサポートしていないため、 <code class="docutils literal notranslate"><span class="pre">airports_airlines</span></code> テーブルは2段階で作成する必要があります。：</p>
<ol class="arabic">
<li><p><span class="menuselection">テーブル ► テーブルを作成…</span> を使用して、 <code class="docutils literal notranslate"><span class="pre">id</span></code> フィールドのみを持つテーブルを準備します。</p></li>
<li><p><span class="menuselection">データベース ► SQLウィンドウ…</span> を使用して、以下のSQLコードを入力し実行します：</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">ALTER</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">airports_airlines</span>
<span class="w">   </span><span class="k">ADD</span><span class="w"> </span><span class="k">COLUMN</span><span class="w"> </span><span class="n">airport_fk</span><span class="w"> </span><span class="nb">INTEGER</span>
<span class="w">   </span><span class="k">REFERENCES</span><span class="w"> </span><span class="n">airports</span><span class="w"> </span><span class="p">(</span><span class="n">id</span><span class="p">)</span>
<span class="w">   </span><span class="k">ON</span><span class="w"> </span><span class="k">DELETE</span><span class="w"> </span><span class="k">CASCADE</span>
<span class="w">   </span><span class="k">ON</span><span class="w"> </span><span class="k">UPDATE</span><span class="w"> </span><span class="k">CASCADE</span>
<span class="w">   </span><span class="k">DEFERRABLE</span><span class="w"> </span><span class="k">INITIALLY</span><span class="w"> </span><span class="k">DEFERRED</span><span class="p">;</span>

<span class="k">ALTER</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">airports_airlines</span>
<span class="w">   </span><span class="k">ADD</span><span class="w"> </span><span class="k">COLUMN</span><span class="w"> </span><span class="n">airline_fk</span><span class="w"> </span><span class="nb">INTEGER</span>
<span class="w">   </span><span class="k">REFERENCES</span><span class="w"> </span><span class="n">airlines</span><span class="w"> </span><span class="p">(</span><span class="n">id</span><span class="p">)</span>
<span class="w">   </span><span class="k">ON</span><span class="w"> </span><span class="k">DELETE</span><span class="w"> </span><span class="k">CASCADE</span>
<span class="w">   </span><span class="k">ON</span><span class="w"> </span><span class="k">UPDATE</span><span class="w"> </span><span class="k">CASCADE</span>
<span class="w">   </span><span class="k">DEFERRABLE</span><span class="w"> </span><span class="k">INITIALLY</span><span class="w"> </span><span class="k">DEFERRED</span><span class="p">;</span>
</pre></div>
</div>
</li>
</ol>
<p>それから、上で説明したようにQGISで2つの <a class="reference internal" href="#one-to-many-relation"><span class="std std-ref">1対多のリレーション</span></a> を設定します。</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">airlines</span></code> テーブルとピボットテーブルの間のリレーション</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">airports</span></code> テーブルとピボットテーブルとの間の第２のリレーション</p></li>
</ul>
<p>これを行うためのより簡単な方法（PostgreSQLのみ）は、 <span class="menuselection">プロジェクト ► プロパティ ► リレーション</span> の <span class="guilabel">リレーションを検索</span> を使用することです。QGISは自動的にデータベース内の全てのリレーションを読み込むので、必要な2つのリレーションを選択するだけで設定ができます。最初にQGISプロジェクトに3つのテーブルを読み込むことを忘れないようにしてください。</p>
<figure class="align-center" id="id10">
<span id="figure-setup-relations"></span><img alt="../../../_images/airports_airlines_relation.png" src="../../../_images/airports_airlines_relation.png" />
<figcaption>
<p><span class="caption-number">図 12.113 </span><span class="caption-text">リレーションと自動検索</span><a class="headerlink" href="#id10" title="Link to this image"></a></p>
</figcaption>
</figure>
<p><code class="docutils literal notranslate"><span class="pre">airport</span></code> や <code class="docutils literal notranslate"><span class="pre">airline</span></code> を削除する場合、QGISは <code class="docutils literal notranslate"><span class="pre">airports_airlines</span></code> テーブルの関連するレコードを削除しません。この作業は、現在の例のようにピボットテーブルの作成時に正しい <em>制約</em> を指定すれば、データベースによって行われます。</p>
<div class="admonition note">
<p class="admonition-title">注釈</p>
<p><strong>N対Mのリレーションと自動トランザクショングループを組み合わせる</strong></p>
<p>このようなコンテキストで作業する場合は、 <span class="menuselection">プロジェクトのプロパティ ► データソース►</span> でトランザクションモードを有効にする必要があります。 QGISは、すべてのテーブル（航空会社、空港、ピボットテーブル）の行を追加または更新できる必要があります。</p>
</div>
<p>最後に、 <span class="menuselection">レイヤプロパティ ► 属性フォーム</span> で、 <code class="docutils literal notranslate"><span class="pre">airports</span></code> レイヤと <code class="docutils literal notranslate"><span class="pre">airlines</span></code> レイヤに対して正しい「要素数」を選択する必要があります。最初のレイヤには <strong>airlines (id)</strong> オプションを、2番目のレイヤには <strong>airports (id)</strong> オプションを選択する必要があります。</p>
<figure class="align-center" id="id11">
<span id="figure-cardinality"></span><img alt="../../../_images/airports_airlines_relation_formproperties.png" src="../../../_images/airports_airlines_relation_formproperties.png" />
<figcaption>
<p><span class="caption-number">図 12.114 </span><span class="caption-text">関係の要素数の設定</span><a class="headerlink" href="#id11" title="Link to this image"></a></p>
</figcaption>
</figure>
<p>これで、サブフォーム内で <span class="guilabel">子地物の追加</span> や <span class="guilabel">既存の子地物をリンク</span> を使用してairlineにairportを（そしてairportにairlineを）関連付けることができるようになりました。 <code class="docutils literal notranslate"><span class="pre">airports_airlines</span></code> テーブルにはレコードが自動的に挿入されます。</p>
<figure class="align-center" id="id12">
<span id="figure-relationship-working"></span><img alt="../../../_images/add_airport_airline.png" src="../../../_images/add_airport_airline.png" />
<figcaption>
<p><span class="caption-number">図 12.115 </span><span class="caption-text">airportsとairlinesのN対Mリレーション</span><a class="headerlink" href="#id12" title="Link to this image"></a></p>
</figcaption>
</figure>
<div class="admonition note">
<p class="admonition-title">注釈</p>
<p><strong>多対1リレーション</strong> 要素数を使用する</p>
<p>N対Mリレーションでピボットテーブルを隠すことが望ましくない場合があります。これは主に、リレーションが確立されたときにのみ値を持つことができる属性がリレーションにあるというのが理由です。テーブルがジオメトリフィールドを持つ場合、ピボットテーブルの外部キーフィールドで <span class="guilabel">地図上の地物特定</span> オプション（ <span class="menuselection">レイヤプロパティ ► 属性フォーム ► 利用可能なウィジェット ► フィールド</span> ）を有効にするとよいかもしれません。</p>
</div>
<div class="admonition note">
<p class="admonition-title">注釈</p>
<p><strong>ピボットテーブルの主キー</strong></p>
<p>ピボットテーブルの主キーには複数のフィールドを使用しないでください。QGIS は単一の主キーを想定しているため、 <code class="docutils literal notranslate"><span class="pre">constraint</span> <span class="pre">airports_airlines_pkey</span> <span class="pre">primary</span> <span class="pre">key</span> <span class="pre">(airport_fk,</span> <span class="pre">airline_fk)</span></code> のような制約は機能しません。</p>
</div>
</section>
<section id="polymorphic-relations">
<span id="polymorphic-relation"></span><span id="index-5"></span><h3><a class="toc-backref" href="#id22" role="doc-backlink"><span class="section-number">12.4.2.3. </span>多態リレーション</a><a class="headerlink" href="#polymorphic-relations" title="Link to this heading"></a></h3>
<section id="the-purpose">
<h4><a class="toc-backref" href="#id23" role="doc-backlink">目的</a><a class="headerlink" href="#the-purpose" title="Link to this heading"></a></h4>
<p>多態リレーションは1-N関係の特殊なケースであり、1つの参照元（ドキュメント）レイヤ内に複数の参照先レイヤの地物が含まれます。これは、参照先レイヤごとに異なる参照元レイヤを必要とする通常のリレーションとは異なっています。参照元（ドキュメント）レイヤに <code class="docutils literal notranslate"><span class="pre">layer_field</span></code> カラムを追加することで単一の参照元（ドキュメント）レイヤとすることができ、ここには参照先レイヤを識別する情報を格納します。最も単純な形は、参照元（ドキュメント）レイヤはこのフィールドに参照先レイヤのレイヤ名を入れるだけです。</p>
<p>より正確に言うならば、多態リレーションは、参照元レイヤが同じ通常のリレーションの集合ですが、参照先レイヤは動的に定義されるものです。レイヤの多態リレーションの設定は、テーブル名、レイヤID、レイヤ名など、参照先レイヤのいくつかのプロパティと一致しなければならない式を使用することで解決されます。</p>
<p>公園に行き、そこで見かけたさまざまな種類の植物 <code class="docutils literal notranslate"><span class="pre">plants</span></code> や動物 <code class="docutils literal notranslate"><span class="pre">animals</span></code> の写真を撮ることを考えてみましょう。それぞれの植物や動物には複数の写真が関連付けられているので、通常の 1:N リレーションで写真を保存する場合、 <code class="docutils literal notranslate"><span class="pre">animal_images</span></code> と <code class="docutils literal notranslate"><span class="pre">plant_images</span></code> という2つの別々のテーブルが必要です。テーブル2つならば問題とはならないかもしれませんが、キノコや鳥などの写真も別々に撮影したいとしたらどうでしょうか。</p>
<p>Polymorphic relations solve this problem as all the referencing features are stored
in the same table <code class="docutils literal notranslate"><span class="pre">documents</span></code>.
For each feature the referenced layer is stored in the <code class="docutils literal notranslate"><span class="pre">referenced_layer</span></code> field
and the referenced feature id in the <code class="docutils literal notranslate"><span class="pre">referenced_id</span></code> field.</p>
</section>
<section id="defining-polymorphic-relations">
<h4><a class="toc-backref" href="#id24" role="doc-backlink">多態リレーションの定義</a><a class="headerlink" href="#defining-polymorphic-relations" title="Link to this heading"></a></h4>
<p>最初に、QGISにレイヤ間の多態リレーションについて知らせましょう。これは、 <span class="menuselection">プロジェクト ► プロパティ...</span> から行えます。 <span class="guilabel">リレーション</span> タブを開き、 <a class="reference internal" href="../../../_images/symbologyAdd.png"><img alt="symbologyAdd" src="../../../_images/symbologyAdd.png" style="width: 1.5em;" /></a> <span class="guilabel">リレーションを追加</span> ボタンの横にある小さな下向き矢印のボタンをクリックします。新しく現れたドロップダウンメニューから、 <span class="guilabel">多態リレーションを追加</span> オプションを選択します。</p>
<figure class="align-center" id="id13">
<span id="figure-define-polymorphic-relation"></span><img alt="../../../_images/polymorphic_relation_properties.png" src="../../../_images/polymorphic_relation_properties.png" />
<figcaption>
<p><span class="caption-number">図 12.116 </span><span class="caption-text">参照元レイヤとして <code class="docutils literal notranslate"><span class="pre">documents</span></code> を、参照先レイヤとして <code class="docutils literal notranslate"><span class="pre">animals</span></code> と <code class="docutils literal notranslate"><span class="pre">plants</span></code> を使用した多態リレーションを追加します。</span><a class="headerlink" href="#id13" title="Link to this image"></a></p>
</figcaption>
</figure>
<ul>
<li><p><strong>Id</strong> は内部的な目的で使用され、ユニークでなければなりません。これは <a class="reference internal" href="vector_properties.html#customize-form"><span class="std std-ref">カスタムフォーム</span></a> を作成するために必要となる場合があります。空のままにしておくと自動でIdを作成しますが、扱いやすいように自分でIdを指定することもできます。</p></li>
<li><p><strong>Referencing Layer (Child)</strong> also considered as child layer,
is the one with the foreign key field on it.
In our case, this is the <code class="docutils literal notranslate"><span class="pre">documents</span></code> layer.
For this layer you need to add a referencing field which points to the other layer,
so this is <code class="docutils literal notranslate"><span class="pre">referenced_id</span></code>.</p>
<div class="admonition note">
<p class="admonition-title">注釈</p>
<p>場合によっては、レイヤ内の地物を一意に識別するためには複数のフィールドが必要となることがあります。このようなレイヤとのリレーションを作成するためには、 <strong>複合キー</strong> 、すなわち、一致するフィールドの複数ペアが必要です。 <a class="reference internal" href="../../../_images/symbologyAdd.png"><img alt="symbologyAdd" src="../../../_images/symbologyAdd.png" style="width: 1.5em;" /></a> <sup>複合外部キーとしてペアのフィールドを追加</sup> ボタンを使用して、必要な数のペアを追加できます。</p>
</div>
</li>
<li><p><strong>レイヤのフィールド</strong> は、評価されたレイヤ式の結果を格納する参照元テーブルのフィールドです。これは、この地物がどのレイヤに属するかの参照テーブルです。 この例では、 <code class="docutils literal notranslate"><span class="pre">referenced_layer</span></code> フィールドがこれに該当します。</p></li>
<li><p><strong>レイヤのフィールド式</strong> は、レイヤのユニークな識別子を評価します。これは、レイヤ名 <code class="docutils literal notranslate"><span class="pre">&#64;layer_name</span></code> やレイヤのID <code class="docutils literal notranslate"><span class="pre">&#64;layer_id</span></code> 、レイヤのテーブル名 <code class="docutils literal notranslate"><span class="pre">decode_uri(&#64;layer,</span> <span class="pre">'table')</span></code> など、レイヤを一意に識別できるものであれば何でも利用できます。</p></li>
<li><p><strong>リレーションの強度</strong> は、親子レイヤ間に生成されたリレーションの強さを設定します。デフォルトの <span class="guilabel">Association</span> タイプは、親レイヤが子レイヤに <em>単に</em> リンクされていることを意味します。 一方、 <span class="guilabel">コンポジション</span> タイプでは、親レイヤを複製するときに子レイヤも複製され、親レイヤの地物を削除すると子レイヤの地物も削除されます。これはすべてのレベルにカスケードしていきます（つまり、子レイヤのそのまた子レイヤ...も一緒に削除されます）。</p></li>
<li><p><strong>参照先レイヤ</strong> は親レイヤとも呼ばれ、主キーを持ち、指し示される側のレイヤです。この例では、 <code class="docutils literal notranslate"><span class="pre">plants</span></code> レイヤと <code class="docutils literal notranslate"><span class="pre">animals</span></code> レイヤがこれに該当します。参照先レイヤの主キーをドロップダウンメニューから定義する必要があり、この例では <code class="docutils literal notranslate"><span class="pre">fid</span></code> です。有効な主キーを定義するには、全ての参照先レイヤで同じ名前のフィールドが存在する必要があることに注意してください。そのようなフィールドが存在しない場合には、多態リレーションを保存することができません。</p></li>
</ul>
<p>一度追加したら、この多態リレーションは <span class="guilabel">多態リレーションを編集</span> メニューエントリから編集ができます。</p>
<figure class="align-center" id="id14">
<span id="figure-list-polymorphic-relations"></span><img alt="../../../_images/polymorphic_relations.png" src="../../../_images/polymorphic_relations.png" />
<figcaption>
<p><span class="caption-number">図 12.117 </span><span class="caption-text">新規作成した多態リレーションとanimalsとplantsに関する子リレーションのプレビュー</span><a class="headerlink" href="#id14" title="Link to this image"></a></p>
</figcaption>
</figure>
<p>上記の例では、以下のデータベーススキーマを使用しています：</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">CREATE</span><span class="w"> </span><span class="k">SCHEMA</span><span class="w"> </span><span class="n">park</span><span class="p">;</span>

<span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">park</span><span class="p">.</span><span class="n">animals</span>
<span class="p">(</span>
<span class="w">   </span><span class="n">fid</span><span class="w"> </span><span class="nb">serial</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">   </span><span class="n">geom</span><span class="w"> </span><span class="n">geometry</span><span class="p">(</span><span class="n">Point</span><span class="p">,</span><span class="w"> </span><span class="mi">4326</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">   </span><span class="n">animal_species</span><span class="w"> </span><span class="nb">text</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">   </span><span class="k">CONSTRAINT</span><span class="w"> </span><span class="n">animals_pkey</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="p">(</span><span class="n">fid</span><span class="p">)</span>
<span class="p">);</span>

<span class="k">CREATE</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="n">animals_geom_idx</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">park</span><span class="p">.</span><span class="n">animals</span><span class="w"> </span><span class="k">USING</span><span class="w"> </span><span class="n">gist</span><span class="w"> </span><span class="p">(</span><span class="n">geom</span><span class="p">);</span>

<span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">park</span><span class="p">.</span><span class="n">plants</span>
<span class="p">(</span>
<span class="w">   </span><span class="n">fid</span><span class="w"> </span><span class="nb">serial</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">   </span><span class="n">geom</span><span class="w"> </span><span class="n">geometry</span><span class="p">(</span><span class="n">Point</span><span class="p">,</span><span class="w"> </span><span class="mi">4326</span><span class="p">)</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">   </span><span class="n">plant_species</span><span class="w"> </span><span class="nb">text</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">   </span><span class="k">CONSTRAINT</span><span class="w"> </span><span class="n">plants_pkey</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="p">(</span><span class="n">fid</span><span class="p">)</span>
<span class="p">);</span>

<span class="k">CREATE</span><span class="w"> </span><span class="k">INDEX</span><span class="w"> </span><span class="n">plants_geom_idx</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">park</span><span class="p">.</span><span class="n">plants</span><span class="w"> </span><span class="k">USING</span><span class="w"> </span><span class="n">gist</span><span class="w"> </span><span class="p">(</span><span class="n">geom</span><span class="p">);</span>

<span class="k">CREATE</span><span class="w"> </span><span class="k">TABLE</span><span class="w"> </span><span class="n">park</span><span class="p">.</span><span class="n">documents</span>
<span class="p">(</span>
<span class="w">   </span><span class="n">fid</span><span class="w"> </span><span class="nb">serial</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">   </span><span class="n">referenced_layer</span><span class="w"> </span><span class="nb">text</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">   </span><span class="n">referenced_id</span><span class="w"> </span><span class="nb">integer</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">   </span><span class="n">image_filename</span><span class="w"> </span><span class="nb">text</span><span class="w"> </span><span class="k">NOT</span><span class="w"> </span><span class="k">NULL</span><span class="p">,</span>
<span class="w">   </span><span class="k">CONSTRAINT</span><span class="w"> </span><span class="n">documents_pkey</span><span class="w"> </span><span class="k">PRIMARY</span><span class="w"> </span><span class="k">KEY</span><span class="w"> </span><span class="p">(</span><span class="n">fid</span><span class="p">)</span>
<span class="p">);</span>
</pre></div>
</div>
</section>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="editing_geometry_attributes.html" class="btn btn-neutral float-left" title="12.3. 編集" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../working_with_raster/index.html" class="btn btn-neutral float-right" title="13. ラスタデータの操作" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2002-now, QGIS project.
      <span class="lastupdated">最終更新: 2025 7月 08, 04:20 +0900
      </span></p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <!-- Transifex follows a particular logic to build target pages:
Expected French translation link for https://docs.qgis.org/3.28/en/docs/user_manual/print_composer/overview_composer.html
would return https://app.transifex.com/qgis/qgis-documentation/translate/#fr/aa6d8bc653526d38b295ca94bf8eee5e
with the md5 value of "github#qgis/QGIS-Documentation#release_3.28#locale/en/LC_MESSAGES/docs/user_manual/print_composer/overview_composer.po"-->
<!--Make sure that mismatching language codes between Transifex and Sphinx are converted-->


  <div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      <span class="fa fa-info-circle"> QGIS Documentation </span>
      v: 3.40
      <span class="fa fa-caret-down"></span>
    </span>

    <div class="rst-other-versions">
      <dl>
        <dt>Languages</dt>
        
          <dd><a href="https://docs.qgis.org/3.40/en/docs/user_manual/working_with_vector/joins_relations.html">en</a></dd>
        
          <dd><a href="https://docs.qgis.org/3.40/cs/docs/user_manual/working_with_vector/joins_relations.html">cs</a></dd>
        
          <dd><a href="https://docs.qgis.org/3.40/de/docs/user_manual/working_with_vector/joins_relations.html">de</a></dd>
        
          <dd><a href="https://docs.qgis.org/3.40/es/docs/user_manual/working_with_vector/joins_relations.html">es</a></dd>
        
          <dd><a href="https://docs.qgis.org/3.40/fr/docs/user_manual/working_with_vector/joins_relations.html">fr</a></dd>
        
          <dd><a href="https://docs.qgis.org/3.40/hu/docs/user_manual/working_with_vector/joins_relations.html">hu</a></dd>
        
          <dd><a href="https://docs.qgis.org/3.40/it/docs/user_manual/working_with_vector/joins_relations.html">it</a></dd>
        
          <dd><a href="https://docs.qgis.org/3.40/ja/docs/user_manual/working_with_vector/joins_relations.html">ja</a></dd>
        
          <dd><a href="https://docs.qgis.org/3.40/ko/docs/user_manual/working_with_vector/joins_relations.html">ko</a></dd>
        
          <dd><a href="https://docs.qgis.org/3.40/lt/docs/user_manual/working_with_vector/joins_relations.html">lt</a></dd>
        
          <dd><a href="https://docs.qgis.org/3.40/nl/docs/user_manual/working_with_vector/joins_relations.html">nl</a></dd>
        
          <dd><a href="https://docs.qgis.org/3.40/pl/docs/user_manual/working_with_vector/joins_relations.html">pl</a></dd>
        
          <dd><a href="https://docs.qgis.org/3.40/pt_BR/docs/user_manual/working_with_vector/joins_relations.html">pt_BR</a></dd>
        
          <dd><a href="https://docs.qgis.org/3.40/pt_PT/docs/user_manual/working_with_vector/joins_relations.html">pt_PT</a></dd>
        
          <dd><a href="https://docs.qgis.org/3.40/ro/docs/user_manual/working_with_vector/joins_relations.html">ro</a></dd>
        
          <dd><a href="https://docs.qgis.org/3.40/ru/docs/user_manual/working_with_vector/joins_relations.html">ru</a></dd>
        
          <dd><a href="https://docs.qgis.org/3.40/zh_Hans/docs/user_manual/working_with_vector/joins_relations.html">zh_Hans</a></dd>
        
      </dl>

      <dl>
        <dt>Versions</dt>
        
          <dd><a href="https://docs.qgis.org/testing/ja/docs/user_manual/working_with_vector/joins_relations.html">testing</a></dd>
        
          <dd><a href="https://docs.qgis.org/latest/ja/docs/user_manual/working_with_vector/joins_relations.html">latest</a></dd>
        
          <dd><a href="https://docs.qgis.org/3.40/ja/docs/user_manual/working_with_vector/joins_relations.html">3.40</a></dd>
        
          <dd><a href="https://docs.qgis.org/3.34/ja/docs/user_manual/working_with_vector/joins_relations.html">3.34</a></dd>
        
          <dd><a href="https://docs.qgis.org/3.28/ja/docs/user_manual/working_with_vector/joins_relations.html">3.28</a></dd>
        
          <dd><a href="https://docs.qgis.org/3.22/ja/docs/user_manual/working_with_vector/joins_relations.html">3.22</a></dd>
        
          <dd><a href="https://docs.qgis.org/3.16/ja/docs/user_manual/working_with_vector/joins_relations.html">3.16</a></dd>
        
          <dd><a href="https://docs.qgis.org/3.10/ja/docs/user_manual/working_with_vector/joins_relations.html">3.10</a></dd>
        
          <dd><a href="https://docs.qgis.org/3.4/ja/docs/user_manual/working_with_vector/joins_relations.html">3.4</a></dd>
        
          <dd><a href="https://docs.qgis.org/2.18/ja/docs/user_manual/working_with_vector/joins_relations.html">2.18</a></dd>
        
      </dl>

       
       <dl>
        <dt>Downloads</dt>
        
          <dd><a href="https://docs.qgis.org/3.40/pdf">PDF</a></dd>
        
          <dd><a href="https://docs.qgis.org/3.40/zip">HTML</a></dd>
        
      </dl>
      

      
       
      <dl>
        <dt>Contribute to Docs</dt>
          <dd>
            <a href="https://github.com/qgis/QGIS-Documentation/edit/master/docs/user_manual/working_with_vector/joins_relations.rst" target="_blank" rel="noopener noreferrer">Edit on GitHub</a>
          </dd>
          
          
          <dd>
            <a href="https://app.transifex.com/qgis/qgis-documentation/translate/#ja/c53cc900e0f64f7844fc7fd36a0fba04" target="_blank" rel="noopener noreferrer">Translate Page</a>
          </dd>
          
          <dd>
            <a href="https://github.com/qgis/QGIS-Documentation/issues" target="_blank" rel="noopener noreferrer">Report Issue</a>
          </dd>
      </dl>
      

      <dl>
        <dt>On QGIS Project</dt>
          <dd>
            <a href="https://qgis.org" target="_blank" rel="noopener noreferrer">Home</a>
          </dd>
          <dd>
            <a href="https://qgis.org/api/3.40" target="_blank" rel="noopener noreferrer">C++ API</a>
          </dd>
          <dd>
            <a href="https://qgis.org/pyqgis/3.40" target="_blank" rel="noopener noreferrer">PyQGIS API</a>
          </dd>
          <dd>
            <a href="https://github.com/qgis/QGIS/tree/release-3_40" target="_blank" rel="noopener noreferrer">Source</a>
          </dd>
      </dl>

    </div>
  </div><script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>